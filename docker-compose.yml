version: '3.8'

services:
  paper-interpreter-api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GEMINI_API_URL=${GEMINI_API_URL:-https://yunwu.ai}
      - NANO_BANANA_API_KEY=${NANO_BANANA_API_KEY}
      - NANO_BANANA_API_URL=${NANO_BANANA_API_URL:-https://yunwu.ai}
      - PAPER_OUTPUT_DIR=/app/paper_outputs
    volumes:
      - ./paper_outputs:/app/paper_outputs
    command: uvicorn web_api:app --host 0.0.0.0 --port 8000 --reload

  paper-interpreter-web:
    build: .
    ports:
      - "8501:8501"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - GEMINI_API_URL=${GEMINI_API_URL:-https://yunwu.ai}
      - NANO_BANANA_API_KEY=${NANO_BANANA_API_KEY}
      - NANO_BANANA_API_URL=${NANO_BANANA_API_URL:-https://yunwu.ai}
    command: streamlit run streamlit_app.py --server.address 0.0.0.0 --server.port 8501

# Usage:
# 1. Create .env file with API keys
# 2. docker-compose up -d api    # Start API server
# 3. docker-compose up -d web    # Start Streamlit web UI
# 4. API: http://localhost:8000
# 5. Web UI: http://localhost:8501
